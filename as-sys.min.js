!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash/core")):"function"==typeof define&&define.amd?define(["lodash/core"],t):(e=e||self).asSys=t(e._)}(this,function(_){"use strict";var eachObj=_&&"function"==typeof _.each?_.each:$.each,mergeObjs=_&&"function"==typeof _.extend?_.extend:$.extend,equalObjs=_&&"function"==typeof _.equal?_.equal:function(e,t){if("object"!=typeof e||"object"!=typeof t)return e===t;var n={};for(var r in e)if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r)||!equalObjs(e[r],t[r]))return!1;n[r]=!0}for(var r in t)if(!n[r]&&t.hasOwnProperty(r)&&(!e.hasOwnProperty(r)||!equalObjs(e[r],t[r])))return!1;return!0},similarObjs=function(e,t){if(e instanceof RegExp)return"string"==typeof t&&null!=t.match(e);if(t instanceof RegExp)return"string"==typeof e&&null!=e.match(t);if("object"!=typeof e||"object"!=typeof t)return e==t;for(var n in e)if(e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&!similarObjs(e[n],t[n]))return!1;return!0},multiScan=function(e,t){if(e.length<2)return!0;for(var n=e[0],r=1,o=e.length;r<o;++r)if(!1===t(n,e[r]))return!1;return!0},a$=function(){for(var e,t,n=[],r=null,o=Array.prototype.slice.call(arguments,0),a=function(){var t=this,n=arguments;t.__initializing||(t.__initializing=!0,eachObj(t.__skills,function(e){e.apply(t,n)}),delete t.__initializing)},i=0;i<o.length;++i){if(null==(t=o[i]))throw{name:"Missing skill",message:"The skill-set liseted ["+t+"] is missing.",skill:p};if("function"==typeof t&&t.prototype!==undefined){if(-1<n.indexOf(t))continue;if(t.prototype.__depends){e=[i,0];for(var p,l=0,f=t.prototype.__depends.length;l<f;++l)p=t.prototype.__depends[l],-1==o.indexOf(p)&&e.push(p);if(2<e.length){Array.prototype.splice.apply(o,e),--i;continue}}if(null!=t.prototype.__expects){r=r||{};for(l=0,f=t.prototype.__expects.length;l<f;++l)r[t.prototype.__expects[l]]=!0}if(n.push(t),a.prototype===undefined?a.prototype=Object.create(t.prototype):mergeObjs(a.prototype,t.prototype),t.prototype.__skills!==undefined){l=0;for(var u,c=t.prototype.__skills.length;l<c;++l)u=t.prototype.__skills[l],-1==n.indexOf(u)&&n.push(u)}}}return eachObj(r,function(e,t){if(!a.prototype[t])throw{name:"Unmatched expectation",message:"The expected method ["+t+"] was not found among provided skills.",method:t}}),Object.defineProperties(a.prototype,{__skills:{enumerable:!1,writable:!1,value:n}}),a};return a$.VERSION="1.0.0",a$.equal=function(){return multiScan(arguments,equalObjs)},a$.similar=function(){return multiScan(arguments,similarObjs)},a$.common=function(e){function M(e,t){if(Array.isArray(e)&&Array.isArray(t)){null==i&&(i=[]);for(var n=0,r=e.length;n<r;++n)-1<t.indexOf(e[n])&&i.push(e[n])}else for(var o in null==i&&(i={}),e)t[o]===undefined||a&&e[o]!=t[o]||(i[o]=e[o])}var a=e,t=0,i=null,n=arguments.length;for("boolean"!=typeof e?a=!1:t=1;++t<n;)M(null==i?arguments[t-1]:i,arguments[t]);return i},a$.weight=function(e){return"object"!=typeof e?1:e.hasOwnProperty("length")&&"number"==typeof e.length?e.length:Object.keys(e).length},a$.clone=function(e){var t=Object.create(Object.getPrototypeOf(e));try{return e.constructor.apply(t,Array.prototype.slice(arguments,1))||t}catch(n){}},a$.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},a$.path=function(agent,path,value){if(null!=path){if(!Array.isArray(path))try{var pref=("["!=path[0]?"agent.":"agent")+path;return value===undefined?eval("value = "+pref):eval(pref+" = value"),value}catch(e){path=path.split(".")}for(var i=0,pl=path.length;i<pl-1;++i)agent=agent[path[i]]=agent[path[i]]||{};return value!==undefined?agent[path[i]]=value:value=agent[path[i]],value}},a$.act=function(e,t){if(null!=e)return"string"==typeof t&&(t=e[t]),"function"==typeof t?t.apply(e,Array.prototype.slice.call(arguments,2)):void 0},a$.broadcast=function(t,n){var r=Array.prototype.slice.call(arguments,2);return eachObj(t.__skills,function(e){"function"==typeof e.prototype[n]&&e.prototype[n].apply(t,r)}),t},a$.pass=function(e,t,n){for(var r,o=e.__skills&&e.__skills.indexOf(t);0<=--o;)if("function"==typeof(r=e.__skills[o]).prototype[n])return r.prototype[n].apply(e,Array.prototype.slice.call(arguments,3))},a$.can=function(e,t){return"object"==typeof e&&"function"==typeof e[t]},a$.aware=function(e,t){return"object"==typeof e&&e[t]!==undefined},a$.capable=function(e,t){var n,r,o=t,a=Object.getPrototypeOf(e),i=1;"boolean"!=typeof o?o=!0:i=2;for(var p=0,l=i,f=arguments.length;i<f;++i)e instanceof(n=arguments[i])?++p:0<(r=a$.weight(n.prototype))&&a$.weight(a$.common(!0,a,n.prototype))==r&&++p;return 0<p&&(!o||arguments.length-l==p)},a$.group=function(e,t,n){"boolean"!=typeof t&&(n=t,t=!1);var r=this.clone(e),o={};for(var a in e){var i=e[a];n.call(i,i,a,e)&&(t&&mergeObjs(o,Object.getPrototypeOf(i)),r.push(i))}if(t){for(var p,l=Object.keys(o),f={},u=0,c=l.length;u<c;++u)f[p=l[u]]={enumerable:!1,writable:!1,value:"function"!=typeof o[p]?o[p]:function(r){return function(){var e=undefined;for(var t in this){var n=this[t];"function"==typeof n[r]&&(e=n[r].apply(n,arguments))}return e}}(p)};Object.defineProperties(r,f)}return r},a$});